# When Agents Trade: Live Multi-Market Trading Benchmark for LLM Agents

## 论文信息

**标题**: When Agents Trade: Live Multi-Market Trading Benchmark for LLM Agents

**作者**: Lingfei Qian, Xueqing Peng, Yan Wang, Vincent Jim Zhang, Huan He, Zehan Li, Hanley Smith, Yi Han, Yueru He, Haohang Li, Yupeng Cao, Yangyang Yu, Alejandro Lopez-Lira, Peng Lu, Jian-Yun Nie, Guojun Xiong, Jimin Huang, Sophia Ananiadou

**会议**: Conference acronym 'XX, Woodstock, NY (2018)

## 研究背景

### 核心问题

基于LLM的智能体能否真正实时交易？这个问题处于金融人工智能的前沿。金融市场具有波动性高、高维度和零容错的特点，为新兴智能提供了最严格的测试环境。交易不仅仅是孤立的预测，而是在每秒都在变化的世界中做出连续的、高风险的决策。

### 现有工作的贡献与局限

**已有的重要工作**:
- **DeepFund**: 引入了多智能体框架，集成实时数据流模拟实时决策
- **InvestorBench**: 将静态评估扩展为交易模拟，通过回放历史数据评估假设收益
- **其他基准**: 专注于金融情感分析、事件提取和金融文本理解，提升了领域理解但未捕捉适应性和反馈

**三个根本性挑战**:

1. **评估模型而非智能体**
   - 现有工作（如DeepFund、InvestorBench）与固定的智能体结构绑定
   - 评估的是模型主干而非智能体本身
   - 即使替换不同的LLM，性能趋势仍保持相似
   - 相同框架导致决策行为趋同

2. **评估范围极其有限**
   - DeepFund仅测试24天的有限时间段
   - 仅关注5只美国股票（Apple、American Express、Bank of America、Coca-Cola、Chevron）
   - 每只股票总共只有24个决策
   - 无法洞察智能体如何跨不同市场状态泛化（牛市/熊市转换、更长交易周期）

3. **输入数据缺乏一致性和验证**
   - 依赖异构数据源（yfinance、Finnhub）获取市场价格和新闻
   - 没有统一的数据获取协议
   - 新闻源频繁重叠或矛盾
   - 同一市场事件可能多次出现或强调不同
   - 引入冗余和不一致性，扭曲信息环境

## 相关工作

### 金融领域的LLM基准测试

**早期金融NLP基准**:
- **FinBen**: 将评估扩展到情感分析和问答之外，包括检索增强任务和多步骤决策问题
- **局限性**: 主要保持静态，以英语为中心

**多语言和多模态扩展**:
- **MultiFinBen**: 将观察扩展到多语言和多模态评估
- **FinReason**: 引入金融推理任务，显示通用推理模型在金融数据上性能下降

**发展趋势**: 从静态评估转向动态交互、从单一语言扩展到多语言支持、从文本扩展到多模态数据

### 交易智能体和实时基准测试

**基于记忆的智能体系统**:
- **FinMem**: 引入记忆增强的LLM智能体
- **InvestorBench**: 在回测市场信息上对智能体进行基准测试
- **FLAG-TRADER**: 将语言模型与策略梯度训练结合用于序列决策

**多智能体协作框架**:
- **FinCon**: 将记忆更新扩展到多智能体交互，提出单股票交易和投资组合管理框架
- **HedgeFundAgents**: 对冲基金层次结构建模，协调中央管理者和对冲专家
- **TradeAgents**: 探索专业交易智能体间的去中心化协调

**实时评估的突破**:
- **DeepFund**: 提出用于基金投资的实时多智能体竞技场，启用LLM驱动策略的动态评估

**现有系统的局限**: 大多数系统在静态环境中运行，缺乏长期、持续的真实市场评估

**AMA的独特定位**: 首个终身运行的实时基准测试，统一的多智能体评估协议，经过验证的持续更新数据流

## 核心创新：Agent Market Arena (AMA)

### 1. 统一协议
- 所有智能体使用相同的初始资金
- 在固定的每日时间交易
- 遵循相同的执行和反馈规则
- 确保公平和可重复的评估

### 2. 验证的信息流
- 持续整合价格数据、金融新闻和公司报告
- 每个数据流都经过标准化、摘要和专家验证
- 检查事实准确性、一致性和中立性
- 为交易决策提供可靠和无偏见的输入

### 3. 多资产市场覆盖
- **股票市场**: Tesla (TSLA)、Biomarin Pharmaceutical (BMRN)
- **加密货币市场**: Ethereum (ETH)、Bitcoin (BTC)
- 提供真实和动态的适应性推理测试平台

### Agent Execution Protocol (AEP)

AEP定义了AMA中所有智能体如何与市场环境交互，标准化三个核心组件以确保性能差异源于推理能力而非实现差异。

#### 统一输入 (Inputs)

每个智能体接收相同的每日输入：

**数据来源**:
- 经过验证的市场数据
- MIS提供的新闻摘要

**输入格式**:
- 资产标识符
- 历史价格数据
- 最近新闻摘要
- 上下文交易元数据

**设计保证**: 所有智能体在相同的市场知识和时间条件下运行

#### 统一输出 (Outputs)

智能体产生离散的每日行动：

**行动空间**: BUY、SELL、HOLD

- **BUY**: 预期资产价值上涨，增加持仓
- **SELL**: 预期资产价值下跌，减少持仓
- **HOLD**: 保持中立或不确定，维持当前持仓

**执行机制**:
- 所有交易决策在固定时间同步执行
- 确保跨模型和市场的公平比较
- 用于更新模拟投资组合和计算次日收益

#### 提示词和超参数 (Prompts and Hyperparameters)

**系统提示词**:
- 定义交易策略
- 描述行动空间

**公平性保证**:
- 温度、重试次数等生成参数在所有智能体和主干模型中固定
- 消除实现层面的差异

### 实现的智能体架构

首次部署了一套最先进的基于LLM的智能体系统，在两只股票和两种加密货币上持续运行。部署始于两个月前，一直不间断运行，执行每日交易并适应实时市场波动。

#### 1. InvestorAgent（单智能体基线）

**架构特点**:
- 单智能体框架
- 集成记忆模块存储历史交易决策和上下文信息

**决策机制**:
- 分析过去结果提取可操作的洞察
- 用于优化和改进未来决策过程
- 代表基础但有效的交易策略

#### 2. TradeAgent（多角色协作）

**架构灵感**: 模仿真实世界的交易公司结构

**专业角色编排**:
- **分析师团队**:
  - 基本面分析师
  - 情感分析师
  - 新闻分析师
  - 技术分析师

**决策流程**:
1. 各专业角色提供独立洞察
2. 研究员智能体辩论和整合观点
3. 交易员智能体汇总形成交易提案
4. 风险管理检查提案
5. 投资组合经理最终执行

**特点**: 不依赖固定技术指标，强调角色分工和协作

#### 3. HedgeFundAgent（对冲基金团队）

**架构模型**: 模拟对冲基金团队运作

**专业角色设计**:
- 模仿著名交易人物的特征
- 例如: Aswath Damodaran、Ben Graham等
- 每个角色模拟投资过程中的不同职责

**决策机制**:
1. 专业智能体生成交易信号
2. 投资组合经理汇总形成交易意图
3. 风险管理者计算风险指标
4. 执行仓位限制

**特点**: 保守对冲策略，强调风险控制

#### 4. DeepFundAgent（记忆自适应）

**设计目标**: 测试在动态环境中的适应性

**核心能力**:
- 处理流式输入
- 生成交易信号
- 基于历史投资组合更新决策

**信息整合**:
- 存储在记忆中的历史投资组合更新
- 媒体信息
- 技术分析

**评估重点**: 
- LLM决策系统在动态环境中的表现
- 与基于规则或静态基准的对比
- 从历史经验中学习和适应的能力

### Performance Analytics Interface (PAI)

#### 交易信号定义

每个智能体每天做出一次交易决策，表示为信号 **w_t ∈ {1, -1, 0}**：

- **w_t = 1**: 买入资产
- **w_t = -1**: 卖出资产
- **w_t = 0**: 持有当前仓位

#### 收益计算

**每日收益**: 
```
r_t = w_t × (P_t - P_{t-1}) / P_{t-1}
```

**累积收益**: 
```
R_t = ∏(i=1 to t)(1 + r_i) - 1
```

#### 五大财务性能指标

**1. 累积收益 (CR - Cumulative Return)**
- **定义**: 衡量智能体投资组合在评估期间的总增长
- **意义**: 捕捉整体盈利能力

**2. 年化收益 (AR - Annualized Return)**
- **公式**: `R_annual = (1 + R_t)^(252/T) - 1`
- **意义**: 将收益调整为年化率，支持跨不同时间跨度的比较
- **252**: 一年的交易日数

**3. 年化波动率 (AV - Annualized Volatility)**
- **公式**: `σ_annual = √252 × std(r_t)`
- **意义**: 反映智能体每日收益的波动程度，量化风险

**4. 夏普比率 (SR - Sharpe Ratio)**
- **公式**: `S = (r̄ - r_f) / σ_annual`
- **假设**: 无风险利率 r_f = 0
- **意义**: 评估智能体将风险转化为回报的效率，风险调整后的性能指标

**5. 最大回撤 (MDD - Maximum Drawdown)**
- **公式**: `D_max = max_t[(max_{i≤t} R_i - R_t) / max_{i≤t} R_i]`
- **意义**: 捕捉从峰值到谷底的最大观察损失，指示下行风险暴露

#### 实时排行榜

**更新频率**: 所有指标每日更新

**展示内容**:
- 跨不同LLM主干的智能体比较
- 跨不同市场类型的性能对比
- 盈利能力、稳定性和适应性的综合评估

**可访问性**: 
- 实时排行榜公开展示：https://ama.thefin.ai/live
- 透明化所有智能体的表现数据

## 实验设置

### LLM模型选择

为每个智能体评估了五种不同的主干模型：

**模型列表**:
- **OpenAI**: GPT-4o、GPT-4.1
- **Google**: Gemini-2.0-flash
- **Anthropic**: Claude-3.5-haiku、Claude-sonnet-4

### 资产选择

评估涵盖股票和加密货币市场，以捕捉不同的市场动态和行为模式。

#### 加密货币

**选择的资产**: Bitcoin (BTC)、Ethereum (ETH)

**市场特征**:
- 高度波动的、情绪驱动的环境
- 对宏观经济和政策信号快速反应
- 提供极端市场波动下模型适应性的严格测试

#### 股票市场

**选择的资产**:
- **Tesla (TSLA)**: 代表高科技行业
- **BioMarin Pharmaceutical (BMRN)**: 代表生物医药行业

**市场特征**:
- 受特定行业基本面影响
- 技术创新、生产指标或临床试验结果驱动
- 评估系统处理结构化、信息丰富上下文的能力

#### 资产组合的意义

**多样性价值**:
- 跨越异质资产类别
- 不同的时间敏感性
- 为真实世界交易条件下的决策智能体提供全面基准

### 智能体初始化和评估

#### 初始化阶段

**时间范围**: 2025-05-01 至 2025-07-31

**初始化目的**:
- 建立历史基础
- 构建上下文记忆
- 适应最近的市场动态
- 模拟现实交易环境
- 形成代表性的投资组合仓位

#### 实时评估阶段

**开始日期**: 2025-08-01

**截至论文撰写日期**: 2025-09-30

**运行状态**:
- 已完成两个月的实时交易
- 继续自主运行
- 每日产生交易行动和性能评估
- 实时更新结果

**持续性**: 智能体将持续运行，作为开放的、不断演进的基准

## 实验结果

### 研究问题

论文围绕四个核心研究问题展开实验：

**RQ1**: LLM智能体能否真正交易？
- 能否在实时市场中做出盈利且一致的决策？
- 能否超越简单的买入持有策略？

**RQ2**: 哪个因素对交易性能贡献更大？
- 智能体的结构框架？
- 底层LLM主干的推理能力？

**RQ3**: 智能体能否有效解读市场信息？
- 如何将复杂市场信息转化为交易决策？
- 能否预测和适应价格波动？

**RQ4**: 不同交易哲学如何影响表现？
- 从激进到保守的策略如何影响决策行为？
- 如何影响跨市场的整体盈利能力？

### 5.1 智能体在实时交易中的性能（RQ1）

#### 总体结论

实验结果确认：**LLM智能体确实可以在实时环境中盈利交易**

**核心发现**:
- 通常超越简单的买入持有策略
- 在动态市场条件下保持稳定性
- 性能因智能体和资产类型而显著不同
- 表现高度依赖设计理念和市场背景

#### 各智能体详细性能

**DeepFundAgent（最平衡一致）**:

| 资产 | 累积收益 | 年化波动率 | 夏普比率 |
|------|----------|------------|----------|
| TSLA | 8.61% | 36.68% | 1.39 |
| BMRN | 9.45% | 22.82% | 1.96 |

- 提供最平衡和一致的结果
- 跨资产表现稳健

**InvestorAgent（竞争力强）**:

- **最佳表现** (GPT-4.1 + TSLA):
  - 累积收益: 40.83%
  - 夏普比率: 6.47
  
- **模型敏感性明显**:
  - BMRN上表现: 3.79% (GPT-4.1) 到 -6.89% (Claude-sonnet-4)
  - 对主干模型和资产高度敏感

**TradeAgent（高波动）**:

- **波动范围大** (TSLA):
  - 从 -38.72% (GPT-4.1) 到 21.91% (Gemini-2.0-Flash)
  
- **与Gemini-2.0-flash配对最佳**:
  - TSLA、ETH、BTC上领先
  - BMRN上排名第二

**HedgeFundAgent（混合结果）**:

- **最佳表现**: ETH上达到39.66% CR
- **部分负收益**: BTC上出现负回报
- **架构优势**: 
  - 16个专业子智能体
  - 2个管理智能体汇总信号
  - 层次协调减少单个LLM引入的方差
  - 跨主干模型保持相对稳健性

#### 智能体-模型互补性

**关键发现**: 没有单一LLM或智能体在所有资产上始终优于其他

**最佳配对策略**:

1. **TradeAgent + Gemini-2.0-flash**:
   - TSLA、ETH、BTC上领先
   - BMRN上排名第二

2. **InvestorAgent + GPT-4.1**:
   - TSLA和BMRN上表现强劲

3. **DeepFundAgent + GPT-4o**:
   - ETH和TSLA上最高回报
   - 跨其余资产保持竞争力

**意义**: 强调多市场评估的重要性，相比受限于有限资产集的分析提供更广泛洞察

### 智能体架构的决定性作用（RQ2）

实验结果表明，**智能体框架的影响远大于模型主干的影响**：

#### 聚合性能对比

**不同智能体框架的影响**:
- 平均累积收益的波动范围显著
- 切换智能体框架时观察到最大和最小CR之间的巨大差异
- 阴影区域（表示范围）在智能体间差异远大于LLM间差异

**不同LLM主干的影响**:
- 在相同智能体框架下切换LLM
- 平均累积收益变化相对较小
- 性能趋势保持相似，决策行为趋同

#### 详细分析方法

**数据聚合**:
- 聚合所有智能体-模型配对的结果
- 图2a: 展示每个智能体在不同LLM下的性能
- 图2b: 展示每个LLM在不同智能体架构下的性能

**观察发现**:

1. **固定智能体框架，修改LLM**:
   - 盈利能力仅产生适度变化
   - 例如：InvestorAgent在TSLA上的结果紧密聚集
   - 跨LLM配置显示最小扩散
   - 表明切换模型效果有限

2. **固定LLM，变化智能体设计**:
   - 导致性能显著分化
   - 例如：GPT-4.1（浅蓝色）跨智能体显示广泛的回报范围
   - 证明智能体结构设计对交易结果的影响更强

#### 关键结论

**智能体架构的决定性作用**：

智能体的架构，包括其**决策逻辑、协调策略和风险控制机制**，在塑造盈利能力和稳定性方面发挥着比单纯升级到更强大模型**更决定性的作用**。

**实践启示**:
- 在AMA环境中，增强智能体如何利用LLM可能比单独改进LLM产生更大的收益
- 投资于优化智能体架构比追求更强大的模型更有价值
- 框架的推理结构比底层语言模型更重要

### 5.3 智能体如何根据市场信号决策（RQ3）

#### 研究设计

**分析对象**:
- **TradeAgent** (使用Gemini-2.0-flash)
- **InvestorAgent** (使用GPT-4.1)
- **测试资产**: Bitcoin (BTC)

**选择BTC的原因**:
- 对市场新闻和情绪高度敏感
- 波动性大，能清晰展示智能体的适应能力

**分析方法**:
- 比较累积收益轨迹与买入持有基线
- 考察智能体如何解读宏观经济信号
- 分析在重大波动事件期间的策略适应

#### 三个关键事件分析

**事件1: 8月13-14日（成功的逆向交易）**

*市场背景*:
- 全球股市进入广泛的看涨势头
- 美国、欧洲、亚洲主要指数创历史新高
- 同步上涨由宽松政策预期和主权资金流入推动
- 媒体描述为近年来最协调的全球反弹之一

*智能体决策*:
- **市场情绪**: 压倒性看涨
- **TradeAgent判断**: 识别出极端乐观情绪的脆弱性
- **策略**: 认识到"史无前例"事件缺乏历史均衡，在峰值附近正确对冲风险
- **结果**: 价格正常化时获利

**事件2: 8月28-29日（技术面与基本面的平衡）**

*罕见的结构性变化*:
1. **政治资本与挖矿结合**: 特朗普支持的American Bitcoin Corp.通过与Gryphon Digital Mining合并在纳斯达克上市
2. **亚洲机构积累**: 日本和韩国主要公司宣布将比特币纳入财政储备
3. **生态系统创新**: RGB协议和Tether在比特币网络的整合，扩展比特币作为价值存储之外的角色

*智能体决策*:
- **基本面**: 长期看涨信号
- **技术面**: TradeAgent检测到短期技术面疲软
- **策略**: 执行SELL操作
- **结果**: 准确预测短期回调

**事件3: 9月28-29日（错误判断案例）**

*市场情况*:
- 初始判断基于ETF资金流出和同步回撤
- TradeAgent的空头仓位初始合理

*突发变化*:
- 流动性突然激增
- 主权资金流入
- 导致空头挤压

*结果*:
- 所有智能体共享此误判
- 反映对突然宏观逆转反应的难度

#### 性能对比分析

**整体表现**:
- 大部分时期，InvestorAgent (GPT-4.1) 和 TradeAgent (Gemini-2.0-flash) 的性能差距保持狭窄
- InvestorAgent在8月13日左右捕捉到早期反弹
- 但错过了后续转折点
- TradeAgent通过利用波动性和更动态地适应情绪变化而超越

**关键洞察**:

**最成功的智能体特征**：能够利用波动期而不仅仅是跟随长期趋势

**原因**: 利用波动性的智能体更适合AMA的每日交易频率

#### 多资产基准的价值

**重要性验证**:
- 持续更新的多资产类别基准基于验证和多样化的市场数据
- 跨股票和加密货币的实时发展证明不能通过静态或单一市场评估公平评估智能体性能

**AMA的优势**:
- 整合经过验证的数据流
- 标准化决策协议
- 在一致和动态的市场条件下系统比较多个智能体
- 提供对不同智能体架构如何在真实世界金融环境中解读的更全面和可泛化理解

### 5.4 交易风格和模式的影响（RQ4）

#### 研究目标

进一步调查交易风格如何塑造AMA框架中的智能体行为。

#### 初始策略分化

**第一天的策略分歧**（基于相同市场信息）:

| 智能体 | 初始偏好 | 风格特征 |
|--------|----------|----------|
| HedgeFundAgent | 空头仓位 | 逆向、高风险 |
| InvestorAgent | 空头仓位 | 跟随趋势、主动 |
| DeepFundAgent | 买入 | 保守、稳健 |
| TradeAgent | 持有 | 波动但可保守 |

**策略对比的演进**:
- 随着交易进展，这些战略对比变得更加明显
- 反映每个框架固有的风险偏好和决策逻辑

#### 两个月交易期间的行为模式

**市场环境**: 整体市场情绪保持乐观

**HedgeFundAgent（逆向高风险）**:
- **行为**: 持续保持空头仓位
- **特点**: 揭示其逆向和高风险本质
- **结果**: 
  - ETH和BMRN上获得可观利润（39.66%和23.70%）
  - TSLA和BTC上遭受重大损失
- **验证原则**: 高风险可能带来更大回报，但也有更大潜在损失

**TradeAgent（灵活激进）**:
- **行为**: 尽管通常更波动，但大多数日子选择持仓
- **特点**: 虽然天生激进，但可根据主干模型表现出保守行为
- **适应性**: 取决于底层LLM配置

**InvestorAgent（趋势跟随）**:
- **行为**: 决策主要跟随主流市场趋势
- **表现**: 累积收益曲线在大部分交易期间优于其他智能体
- **交易风格**: 
  - 频繁执行买入和卖出操作
  - 展现主动和冒险的交易风格
  - 整体盈利能力在各资产间保持适度
- **风险管理**: 在高风险期间采取相对谨慎立场

**DeepFundAgent（保守稳健）**:
- **行为**: 展现更保守的决策模式
- **特点**: 
  - 频繁选择"投票"行动
  - 跨多个资产保持稳定回报
- **机制**: 谨慎可能源于记忆自适应机制
  - 能够借鉴先前的高风险经验
  - 调整决策趋向更规避风险的行为
- **结果**: 实现一致的适度收益

#### 风格与性能的关系

**关键发现**: 交易风格是盈利能力和风险暴露的关键决定因素

**风险-回报权衡**:

| 风格 | 智能体 | 特征 | 典型结果 |
|------|--------|------|----------|
| 保守 | DeepFundAgent | 稳定适度收益 | 一致但适度的回报 |
| 激进 | HedgeFundAgent | 高波动 | ETH/BMRN高收益，TSLA/BTC重大损失 |
| 平衡 | InvestorAgent | 跟随趋势 | 大部分时期领先，整体适度 |
| 灵活 | TradeAgent | 根据模型调整 | 取决于LLM配对 |

**基本市场原则验证**: 高风险可能带来更大回报，但也有更大潜在损失


## 结论

本研究引入了AMA，这是首个持续更新的、多资产类别的基准测试平台，用于实时评估基于LLM的交易智能体。

### AMA的三大核心组件

1. **经过验证的多市场信息流**
   - 确保数据质量和可靠性
   - 覆盖多个市场和资产类别

2. **统一的交易协议**
   - 标准化智能体交互方式
   - 保证公平的评估条件

3. **透明的性能界面**
   - 公开所有交易数据和结果
   - 支持社区验证和改进

### 研究价值

AMA为在真实市场条件下研究金融交易智能体建立了**可重现和动态的基础**，弥合了语言理解与实时决策制定之间的差距，提供了首个终身运行的、多资产类别的实时评估平台

### 未来工作方向

论文计划扩展AMA的功能：

1. **智能体间通信**
   - 实现智能体之间的信息交换
   - 探索协作决策机制

2. **跨资产动态**
   - 研究跨资产配置策略
   - 分析资产间相关性影响

3. **强化学习反馈**
   - 整合强化学习机制
   - 实现自我改进能力

**最终目标**: 推进对LLM驱动系统中自主金融智能的更深入理解

## 研究意义

**学术贡献**:
- 首个终身运行的实时交易基准测试平台
- 提供严格的评估标准和可重现的方法论
- 建立持续演进的评估体系

**实践启示**:
- **架构优于模型**: 智能体设计比LLM选择对性能影响更大
- **风格塑造结果**: 交易风格决定风险-回报特征和长期稳定性
- **适应性关键**: 利用波动性的智能体比单纯跟随趋势者表现更佳
- **记忆增强**: DeepFundAgent通过经验学习在高波动市场中展现更强适应性

## 与本项目的相关性

**Trading_agent项目的借鉴点**:

1. **评估方法论**: 参考AMA的五大财务性能指标（CR、AR、AV、SR、MDD）完善回测系统
2. **智能体架构**: DeepFundAgent的记忆推理机制与我们的记忆系统设计思路一致
3. **多市场扩展**: 考虑扩展到加密货币等多资产类别
4. **行为分析**: 学习如何量化和分析不同交易风格的智能体行为模式
5. **数据验证**: 加强统一的数据获取协议和验证流程
